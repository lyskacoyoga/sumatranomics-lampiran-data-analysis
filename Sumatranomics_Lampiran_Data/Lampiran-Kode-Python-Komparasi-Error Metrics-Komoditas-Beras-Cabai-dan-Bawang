import pandas as pd
import matplotlib.pyplot as plt
from sklearn.metrics import mean_absolute_error, mean_squared_error
import numpy as np
from statsmodels.tsa.arima.model import ARIMA

#Baca data
file_path = "Data Fiks.xlsx"
df = pd.read_excel(file_path, sheet_name="DATA FIKS")

#Pastikan kolom ada di data
komoditas = ["Harga Beras (Rp/Kg) (Harga Ritel)", "Harga Cabai (Rp/Kg) (Harga Ritel)", "Harga Bawang (Rp/Kg) (Harga Ritel)"]
tahun = df["Tahun"]

#Fungsi hitung error metrics
def get_metrics(series):
    series = series.dropna()
    model = ARIMA(series, order=(1,1,1))
    model_fit = model.fit()

    pred_in = model_fit.predict(start=series.index[0], end=series.index[-1], typ="levels")

    mae = mean_absolute_error(series, pred_in)
    rmse = np.sqrt(mean_squared_error(series, pred_in))
    mape = np.mean(np.abs((series - pred_in) / series)) * 100

    return mae, rmse, mape

#Hitung metrics untuk tiap komoditas
results = {}
for komod in komoditas:
    metrics = get_metrics(df[komod])
    results[komod] = metrics

#Buat DataFrame hasil
metrics_df = pd.DataFrame(results, index=["MAE", "RMSE", "MAPE"]).T

#Plot grafik komparasi
metrics_df.plot(kind="bar", figsize=(10,6))
plt.title("Komparasi Error Metrics: Beras vs Cabai vs Bawang")
plt.ylabel("Nilai Error")
plt.xticks(rotation=0)
plt.legend(title="Metrik")
plt.grid(True, axis="y", linestyle="--", alpha=0.7)
plt.show()

#Cetak tabel hasil
print(metrics_df)
